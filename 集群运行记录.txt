# 环境安装
git clone https://github.com/hhaAndroid/Detic.git
git submodule update --init --recursive
git checkout hha

# 安装
conda create --name detic python=3.8 -y
conda activate detic
conda install pytorch==1.12.0 torchvision==0.13.0 cudatoolkit=11.3 -c pytorch -c conda-forge

export HTTPS_PROXY=http://10.1.8.5:32680/
scl enable devtoolset-7 bash
conda activate detic
git clone https://github.com/facebookresearch/detectron2.git
cd detectron2
pip install -e .

cd ..
pip install -r requirements.txt

验证是否成功
wget https://web.eecs.umich.edu/~fouhey/fun/desk/desk.jpg
wget https://dl.fbaipublicfiles.com/detic/Detic_OVCOCO_CLIP_R50_1x_max-size_caption.pth
python demo.py --config-file configs/Detic_OVCOCO_CLIP_R50_1x_max-size_caption.yaml --input desk.jpg --output out.jpg --vocabulary coco --opts MODEL.WEIGHTS Detic_OVCOCO_CLIP_R50_1x_max-size_caption.pth

# 数据准备
软链接 coco 数据到 datasets 下
ln -s /nvme/data/coco/ datasets/

第一步生成 coco-zero-shot 文件夹
python create_ov_coco_json.py
python tools/get_coco_zeroshot_oriorder.py --data_path datasets/coco-zero-shot/instances_train2017_seen_2.json
python tools/get_coco_zeroshot_oriorder.py --data_path datasets/coco-zero-shot/instances_val2017_all_2.json
python tools/get_lvis_cat_info.py --ann datasets/coco-zero-shot/instances_train2017_seen_2_oriorder.json
python tools/get_cc_tags.py --cc_ann datasets/coco/annotations/captions_train2017.json --out_path datasets/coco-zero-shot/captions_train2017_tags_allcaps.json --allcaps --convert_caption --cat_path datasets/coco/annotations/instances_val2017.json

评估
python train_net.py --num-gpus 8 --config-file configs/Detic_OVCOCO_CLIP_R50_1x_max-size_caption.yaml --eval-only MODEL.WEIGHTS Detic_OVCOCO_CLIP_R50_1x_max-size_caption.pth

# 第一步训练 bbox_sup
python train_net.py --num-gpus 8 --config-file configs/BoxSup_OVCOCO_CLIP_R50_1x.yaml
# 第二步训练，需要利用第一步权重
python train_net.py --num-gpus 8 --config-file configs/Detic_OVCOCO_CLIP_R50_1x_max-size_caption.yaml
